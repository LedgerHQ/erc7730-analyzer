# üìä Clear Signing Audit Report

**Generated:** 2025-10-28 10:38:49

**Contract ID:** WETH

**Total Deployments Analyzed:** 2

**Chain IDs:** 1, 11155111

---

## Summary Table

| Function | Selector | Severity | Issues | Link |
|----------|----------|----------|--------|------|
| `deposit` | `0xd0e30db0` | üü¢ Minor | No fields defined in the ERC-7730 format (fields: []). Result: UI will likely sh... | [View](#selector-d0e30db0) |

---

## üìà Statistics

| Metric | Count |
|--------|-------|
| üî¥ Critical | 0 |
| üü° Major | 1 |
| üü¢ Minor | 0 |
| ‚úÖ No Issues | 0 |
| **Total** | **1** |

---

# Detailed Analysis

## <a id="selector-d0e30db0"></a> deposit

**Selector:** `0xd0e30db0` | **Signature:** `deposit()`

**Contract Address:** `0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2` | **Chain ID:** 1

<details>
<summary><b>üìã ERC-7730 Format Definition</b></summary>

```json
{
  "format": {
    "intent": "Wrap",
    "fields": []
  }
}
```

</details>

<details>
<summary><b>üîç Side-by-Side Comparison (ABI vs ERC-7730)</b></summary>

### Transaction 1: `0x9f89754787ab66ad9fe44995864322addf12c887cc623f0529fb222c525fe775`

**Block:** 23675370 | **From:** 0x3fdfe2e82c8758d52ee7d3eddf5ec69b8c25eac5 | **Value:** 72500000000000000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 2: `0xf720ab095284192bdaff49bd4956eebc18b1e7c697d1db1a055be478daa2d800`

**Block:** 23675353 | **From:** 0x35f4bf317399093eeb7b9f6c6144458753514cfa | **Value:** 1432004218685227000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 3: `0xd2bf19b86434da243028c7a9eedd7497c6240f40cee515ac0b214d6570429bdb`

**Block:** 23675337 | **From:** 0xf8561518a5d1f1ccdab45b9c5276e5819b13e4c1 | **Value:** 20000000000000000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 4: `0x5bdcf45e3b60daa13f8abc985ed2d63a83e7de3f4f017b3533d8b025d8a2b2b5`

**Block:** 23675336 | **From:** 0xd0e72c1b2eb87e3dc0445b7f689cadcfc872b293 | **Value:** 45000000000000000000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 5: `0x1100df028415123a517f086d29de73fd44edd120aeba7b9e9b69766a9cdbc7ee`

**Block:** 23675335 | **From:** 0x9deb4fd3ced8a4065bfbe86b16378eddeea57f6a | **Value:** 16900000000000000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

</details>

---

## üîç Clear Signing Audit Report

### üìã Function: deposit()

**Selector:** `0xd0e30db0`

---

### 1Ô∏è‚É£ Intent Analysis

> **Declared Intent:** *"Wrap"*

The declared intent "Wrap" is accurate: deposit() is payable and credits the caller's internal balance (classic WETH-style deposit), which effectively wraps native ETH into the contract's token balance. No spelling/grammar issues.

---

### 2Ô∏è‚É£ Critical Issues

> üî¥ **CRITICAL** - Issues that could lead to users being deceived or losing funds

‚úÖ No critical issues found.

Rationale:
- The function is simple: payable deposit() increments balanceOf[msg.sender] by msg.value and emits Deposit(msg.sender, msg.value). The on-chain logs show the Deposit event for each transaction (receipt_logs), matching the intended wrap behavior.
- The ERC-7730 format provided contains only the top-level intent "Wrap" and an empty "fields" array. That is a display deficiency (it will not show amounts or token types). According to the strict critical rules, the highest-risk items are wrong tokens/amounts, inverted tokens, missing recipient inputs, broken $ref paths, or native-ETH transfer that cannot be displayed despite being representable via the transaction inputs or metadata. In this case:
  - The contract actually receives native ETH (msg.value) and credits the caller's balance (wrap). That is correctly captured by events/logs.
  - The metadata does not show any fields; though it's a serious display omission, it is not showing wrong token addresses or wrong amounts ‚Äî it simply shows nothing.
  - The input needed to show the native amount (msg.value) is not an ABI parameter but is inherent to the transaction. The spec expects payable functions to expose msg.value via a field such as path "@.value" or tokenAmount with nativeCurrencyAddress ‚Äî this is a display issue but not a mismatch between displayed and actual token/amount on-chain.
- Given the CRITICAL definition's emphasis on final tokens/amounts being wrong (user loses money or receives wrong token), there is no evidence the ERC-7730 metadata claims a different token/address or wrong amounts. Therefore, under the ultra-strict rule set, no critical item (as defined) is present.

(If you prefer a maximally conservative stance: treat the lack of any amount/token fields for a payable wrapping call as a critical UX/security omission; see Display Issues and Recommendations below.)

---

### 3Ô∏è‚É£ Missing Parameters

> ‚ö†Ô∏è *Parameters present in ABI but NOT shown to users in ERC-7730*

There are no ABI input parameters for deposit() (it takes no calldata parameters). However, the transaction implicitly carries msg.value (native ETH) which is critical to display.

| Parameter | Why It's Important | Risk Level |
|-----------|-------------------:|:----------:|
| msg.value (native ETH amount sent) | The function's behavior depends entirely on msg.value; users must see how much ETH they are sending and that it will be wrapped into the contract's token balance. | üî¥ High |

Notes:
- msg.value is not an ABI parameter but is essential transactional input. The current ERC-7730 metadata defines no fields, so the user will not see the amount they are sending nor the resulting WETH-equivalent credited. This is the primary omission.

---

### 4Ô∏è‚É£ Display Issues

> üü° **Issues with how information is presented to users**

- No fields defined in the ERC-7730 format (fields: []). Result: UI will likely show only intent "Wrap" and no amounts, no token identity (WETH), and no indication of msg.value ‚Äî users will not see what they are sending/receiving.
- Native ETH handling missing: there is no field with path "@.value" or any tokenAmount field referencing a nativeCurrencyAddress sentinel. For a payable wrap function, the display should show ETH sent (msg.value) and the wrapped token received (WETH).
- Receiving asset not declared: metadata does not indicate WETH token address as the receiving token. Users may not realize sending ETH will credit WETH balance in the contract.
- $ref/definitions: not used here, but the empty format makes the definitions/constants unused ‚Äî orphaned/no content. Not a spec error, but it's useless to end-users.
- Minor: intent "Wrap" is succinct but would benefit from a short label like "Wrap ETH ‚Üí WETH" for clarity.

DISPLAY EDGE CASE:
- The contract accepts native ETH and credits internal ERC20-like balanceOf. The current metadata trusts no inputs (none exist) and shows nothing; additionally, if the UI relied on a user-supplied receivingAssetId parameter (not present here) it could show a wrong token ‚Äî not applicable here, but a general caution.

Recommended fix details (examples below).

---

### 5Ô∏è‚É£ Transaction Samples - What Users See vs What Actually Happens

(Do not include tx hash, block, from, or values per instructions.)

#### üìù Transaction 1 (sample from provided logs)

**User Intent (from ERC-7730):**

| Field | ‚úÖ User Sees | ‚ùå Hidden/Missing |
|-------|-------------|-------------------|
| Intent | "Wrap" | ‚Äî |
| Amount | (no field shown) | msg.value (ETH sent) |
| Receiving token | (no field shown) | WETH credited to balanceOf[msg.sender] |

**Actual Effects (from receipt_logs):**

| Event | Details | Disclosed? |
|-------|---------|:----------:|
| Deposit(address,uint256) | Emitted by contract, shows sender and ETH amount (msg.value) | ‚ùå Not shown by metadata |
| Internal balance change | balanceOf[msg.sender] increased by msg.value (credited WETH units) | ‚ùå Not shown by metadata |

Repeat behavior for other transaction samples: each receipt_log contains the same Deposit event with amount; the metadata will not surface that information.

---

### 6Ô∏è‚É£ Overall Assessment

| Metric | Score/Rating | Explanation |
|--------|--------------|-------------|
| **Coverage Score** | 2 / 10 | Intent is correct ("Wrap") but metadata defines zero fields: no amount, no token info, no native ETH display. |
| **Security Risk** | üü° Medium | The contract does what is expected on-chain and emits events, so there is no mismatch in tokens/amounts. However UI omission of msg.value and receiving token (WETH) risks user confusion and accidental ETH transfers without clear confirmation. |

#### üí° Key Recommendations
1. Expose msg.value explicitly. Add a field to show ETH sent:
   - Example (simple amount):
     {"path":"@.value","label":"ETH to wrap","format":"amount"}
   - This ensures the UI shows how much native ETH the user is sending.
2. Show the received token (WETH) and the amount credited. Two approaches:
   - If the UI should show a tokenAmount for the WETH token:
     - Add a metadata constant for the WETH address (e.g., $.metadata.constants.wethAddress) and then a tokenAmount field referencing that constant and msg.value as the amount.
     - Example (tokenAmount using a constant token address and native sentinel):
       {
         "path": "@.value",
         "label": "WETH received",
         "format": "tokenAmount",
         "params": {
           "tokenPath": "$.metadata.constants.wethAddress",
           "nativeCurrencyAddress": ["$.metadata.constants.addressAsEth"]
         }
       }
   - Or simpler: show ETH sent and a note "Credited as WETH to your balance" in the label or description.
3. Add a clear label and short description: "Wrap ‚Äî send ETH to receive WETH (balance credited in contract)". This reduces surprise.
4. Ensure definitions/constants exist and point to correct addresses:
   - $.metadata.constants.wethAddress = 0xC02aa... (if this contract is WETH)
   - $.metadata.constants.addressAsEth = sentinel used elsewhere in the registry (so tokenAmount can render native symbol correctly).
5. Optional: include a line showing the Deposit event is emitted (or that the contract will credit balanceOf), e.g., a small note confirming "Contract will emit Deposit(address,uint256) and credit WETH balance."

---

Summary (short):
- On-chain behavior: deposit() is payable, increments balanceOf[msg.sender] by msg.value and emits Deposit ‚Äî matches classic WETH deposit.
- ERC-7730 metadata currently contains only intent "Wrap" and no fields. That will cause UIs to omit crucial information: the ETH amount sent (msg.value) and the WETH credited. This is a significant UX/confirmation omission and should be remedied by adding fields as shown above.

---

