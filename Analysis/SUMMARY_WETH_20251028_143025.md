# üìä Clear Signing Audit Report

**Generated:** 2025-10-28 14:30:25

**Contract ID:** WETH

**Total Deployments Analyzed:** 2

**Chain IDs:** 1, 11155111

---

## Summary Table

| Function | Selector | Severity | Issues | Link |
|----------|----------|----------|--------|------|
| `deposit` | `0xd0e30db0` | üî¥ Critical | The ERC-7730 format's "fields" array is empty. This is a payable function (deposit() uses msg.value)... | [View](#selector-d0e30db0) |

---

## üìà Statistics

| Metric | Count |
|--------|-------|
| üî¥ Critical | 1 |
| üü° Major | 0 |
| üü¢ Minor | 0 |
| ‚úÖ No Issues | 0 |
| **Total** | **1** |

---

# Detailed Analysis

## <a id="selector-d0e30db0"></a> deposit

**Selector:** `0xd0e30db0` | **Signature:** `deposit()`

**Contract Address:** `0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2` | **Chain ID:** 1

<details>
<summary><b>üìã ERC-7730 Format Definition</b></summary>

```json
{
  "format": {
    "intent": "Wrap",
    "fields": []
  }
}
```

</details>

<details>
<summary><b>üîç Side-by-Side Comparison (ABI vs ERC-7730)</b></summary>

### Transaction 1: `0x59375a3b71fb7743ab02cebaca917a303505d032594ce41318c4cf8311ba8e86`

**Block:** 23676517 | **From:** 0xecaa514ce7ddf6a2174630ee49320cff8ff47b44 | **Value:** 70679824392769930

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 2: `0x5b48c37613d90f9efcd0566e59ec23d2898032c2b1ae129eee4939ec019636f7`

**Block:** 23676509 | **From:** 0x6b23dba7851f183da141ae51dcbf10c2fb8bf351 | **Value:** 50000000000000000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 3: `0x008a4f400b7e8045f41131018127587b7b2eb51f148b9b9de62755f65d007c01`

**Block:** 23676507 | **From:** 0xa7d78a099ca33f270832c1d565dd94b535311ccf | **Value:** 20290868599452347

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 4: `0x458b922b40d6dfe02aae525add728475b3a72845a8a79fef53a04ad745f058db`

**Block:** 23676505 | **From:** 0x8674d2b7c4cd780986698323108c4d8eae6e608e | **Value:** 32100000000000000

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

### Transaction 5: `0x79ae5d10d139e48208559abb683082b5c15d565d6edaf65e204ab78aad3b60d5`

**Block:** 23676501 | **From:** 0xecaa514ce7ddf6a2174630ee49320cff8ff47b44 | **Value:** 71725551396477800

| Parameter | ABI-Decoded (Raw) | ERC-7730 (User Sees) |
|-----------|-------------------|----------------------|

#### üìã Transaction Events (from receipt)

| Event | Token | Details | Amount |
|-------|-------|---------|--------|
| ‚ùì Unknown | `0xc02aaa39...` | Signature: `0xe1fffcc4923d04b5...` | - |

</details>

---

## üîç Clear Signing Audit Report

### üìã Function: deposit()

**Selector:** 0xd0e30db0

---

### 1Ô∏è‚É£ Intent Analysis

> **Declared Intent:** *"Wrap"*

The intent "Wrap" is accurate (deposit() wraps native ETH into WETH), concise, and has no spelling/grammar issues ‚Äî but the metadata does not surface the actual ETH amount or the resulting WETH credit.

---

### 2Ô∏è‚É£ Critical Issues

> üî¥ **CRITICAL** - Issues that could lead to users being deceived or losing funds

- The ERC-7730 format's "fields" array is empty. This is a payable function (deposit() uses msg.value), and with no amount field the UI will not display the ETH the user is sending (msg.value). Per the spec rules, a payable function that accepts native ETH MUST expose the amount (e.g., via "@.value" or tokenAmount with nativeCurrencyAddress); absence is critical because a normal user would be surprised/shocked that the amount sent is not shown.
- The metadata does not present the resulting token credited (WETH) or the credited amount. Receipt logs emit a Deposit event with the sender and amount; that final "received" token/amount is not shown to the user in the provided format.

Why these are critical:
- Users will send native ETH but the UI will show no amount (or nothing meaningful) ‚Äî this is exactly the kind of omission that causes users to lose or mis-send funds.
- The missing display of the received token (WETH) makes the outcome unclear: user expects to wrap ETH into WETH but the UI may fail to communicate that.

(There are no broken $ref references or ABI-parameter mismatches in the provided format ‚Äî the critical problem is the missing amount display for a payable function.)

---

### 3Ô∏è‚É£ Missing Parameters

> ‚ö†Ô∏è *Parameters present in ABI but NOT shown to users in ERC-7730*

| Parameter | Why It's Important | Risk Level |
|-----------|-------------------:|:---------:|
| (none ‚Äî deposit() has no input params) | n/a | üü¢ Low |

‚úÖ All ABI parameters are covered (there are none).  
However: msg.value (the ETH amount sent) is not an ABI parameter but is essential for user display and is currently not shown ‚Äî covered under Display Issues / Criticals.

---

### 4Ô∏è‚É£ Display Issues

> üü° **Issues with how information is presented to users**

- No amount field: The "fields" array is empty. For a payable deposit() this means msg.value (ETH sent) will not appear in the UI. (CRITICAL ‚Äî flagged above.)
- No explicit display that user receives WETH: deposit() credits the caller (emits Deposit event), but the metadata does not show an outgoing token (WETH) or map the deposit to a tokenAmount display. This makes the final token outcome opaque.
- Potential UX ambiguity: Intent = "Wrap" hints at ETH ‚Üí WETH, but without an amount or receiving-token field the user cannot confirm amounts or tokens.
- No nativeCurrencyAddress or tokenPath defined anywhere (there are no fields), so native ETH cannot be displayed with token formatting (ticker/symbol) even though ETH is being sent.
- No leftover/broken $refs found ‚Äî metadata is minimal/empty rather than broken.

Display edge-case note:
- Because this function relies solely on msg.value and has no input token parameters, the correct display should use @.value or a tokenAmount referencing the native ETH sentinel; relying on a user input tokenPath would be wrong here. Current metadata shows neither.

Suggested fixes (examples):
- Minimal fix to show ETH sent:
  {"path":"@.value","label":"Amount (ETH)","format":"amount"}
- Better fix to show wrap (ETH ‚Üí WETH):
  - Add a constant for WETH address in metadata.constants.
  - Show "Sending: ETH" via {"path":"@.value","label":"Sending","format":"amount","params":{"displayAs":"ETH"}} OR tokenAmount that supports native sentinel.
  - Show "Receiving: WETH" via {"path":"@.value","label":"Receiving","format":"tokenAmount","params":{"tokenPath":"$.metadata.constants.wethAddress"}} ‚Äî or use a separate path if you can map msg.value to minted WETH (same numeric value for WETH deposit).

---

### 5Ô∏è‚É£ Transaction Samples - What Users See vs What Actually Happens

(We analyze up to 3 samples from the provided list. We do not reprint hashes/blocks/addresses.)

#### üìù Transaction 1 (sample with value 0.07067982439276993 ETH)

**User Intent (from ERC-7730):**

| Field | ‚úÖ User Sees | ‚ùå Hidden/Missing |
|-------|-------------:|------------------:|
| Intent | "Wrap" | ‚úîÔ∏è indicates wrapping, but no amounts shown |
| Amount | nothing (fields empty) | msg.value = 0.07067982439276993 ETH (not shown) |
| Receiving token | nothing | WETH credited to sender (not shown) |

**Actual Effects (from receipt_logs):**

| Event | Details | Disclosed? |
|-------|---------|:---------:|
| Deposit event | Contract emitted Deposit(sender, amount) ‚Äî amount = 0.07067982439276993 ETH | ‚ùå Not shown in metadata |
| Final outcome | Sender's WETH balance increased by amount (on-chain) | ‚ùå Not shown |

#### üìù Transaction 2 (sample with value 0.05 ETH)

**User Intent (from ERC-7730):**

| Field | ‚úÖ User Sees | ‚ùå Hidden/Missing |
|-------|-------------:|------------------:|
| Intent | "Wrap" | No amounts shown |
| Amount | nothing | msg.value = 0.05 ETH (not shown) |

**Actual Effects (from receipt_logs):**

| Event | Details | Disclosed? |
|-------|---------|:---------:|
| Deposit event | Deposit(sender, 0.05 ETH) | ‚ùå Not shown |

#### üìù Transaction 3 (sample with value ~0.020290868599452347 ETH)

**User Intent (from ERC-7730):**

| Field | ‚úÖ User Sees | ‚ùå Hidden/Missing |
|-------|-------------:|------------------:|
| Intent | "Wrap" | No numeric amount |
| Amount | nothing | msg.value = ~0.020290868599452347 ETH (not shown) |

**Actual Effects (from receipt_logs):**

| Event | Details | Disclosed? |
|-------|---------|:---------:|
| Deposit event | Deposit(sender, amount) emitted | ‚ùå Not shown |

Summary: In every sample the on-chain Deposit event records sender and amount, but the current ERC-7730 format would not show those amounts to the user.

---

### 6Ô∏è‚É£ Overall Assessment

| Metric | Score/Rating | Explanation |
|--------|-------------:|-------------|
| **Coverage Score** | 2/10 | Intent declared correctly ("Wrap") but the format exposes no fields; msg.value and resulting WETH credit are absent so core information is missing. |
| **Security Risk** | üî¥ High (UX-critical) | Users can and will send ETH without the UI showing the amount or resulting token; this risks user confusion and potential monetary loss or surprise. |

#### üí° Key Recommendations
- Immediately add an amount field exposing msg.value:
  - Example: {"path":"@.value","label":"Amount (ETH)","format":"amount"}
- Explicitly show the receiving token (WETH) and amount:
  - Add a metadata constant for the WETH token address and add a tokenAmount field referencing that constant so users see "Receiving: WETH 0.05".
- Use nativeCurrencyAddress or tokenAmount definitions so ETH is displayed with symbol (ETH) and decimals.
- Validate UI after changes using sample transactions: ensure the UI shows the same numeric amount as the Deposit event's data field.
- Prefer explicit labels: "Send ETH (wrap to WETH)" and "Receive WETH" to avoid ambiguity.

---

If you want, I can produce the exact ERC-7730 JSON patch (fields + constants) to cover msg.value and show received WETH (including sample token constant) so the UI will display both sent ETH and received WETH amounts.

---

